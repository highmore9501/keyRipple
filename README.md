## 项目概述

keyRipple 是一个将 MIDI 音乐转换为钢琴/键盘演奏动画的项目。

成品视频：[基尼奇 - God knows](https://www.bilibili.com/video/BV1huaWzjEKV)

该项目最初基于我的另一个项目 fretDance（将 MIDI 音乐转换为吉他演奏动画），两者的实现思路和逻辑基本一致。

## 使用方法

目前项目尚未提供图形界面，使用时需要直接操作 [key_ripple.ipynb](key_ripple.ipynb) 文件，手动修改其中的 MIDI 文件路径、FPS、音轨等参数。

### 具体操作步骤：

1. 将 MIDI 文件放置在 `asset/midi/` 文件夹下
2. 修改代码中的 MIDI 文件名
3. 设置 FPS 参数（帧率），需与 Blender 中播放动画时设置的帧率保持一致
4. 选择要处理的音轨

### 音轨处理建议：

- 处理前建议使用 MIDI 软件打开文件，确认需要处理的音轨
- 支持多轨处理，但不建议同时处理两个不相关的音轨，否则可能导致动画混乱
- 多轨处理适用于以下情况：演奏者使用同一乐器但在演奏过程中切换了音色/效果器，因此在 MIDI 中被记录为多轨

更多使用方法可参考 fretDance 项目，其文档链接至专门的知乎专栏，并提供系列视频教程。

## 实现原理

对于钢琴演奏的手部位置，根据大拇指是否弹奏黑键，共定义了 6 种状态：

- `high_black`：手位置在最右侧，且大拇指弹奏黑键
- `high_white`：手位置在最右侧，且大拇指弹奏白键
- `middle_black`：手位置在中间，且大拇指弹奏黑键
- `middle_white`：手位置在中间，且大拇指弹奏白键
- `low_black`：手位置在最左侧，且大拇指弹奏黑键
- `low_white`：手位置在最左侧，且大拇指弹奏白键

通过记录这 6 个基准位置的手部状态值，可以使用插值算法计算出几乎所有演奏状态下的手部状态值。

### 项目核心流程：

1. 根据 MIDI 音符和时间轴计算指法
2. 结合预先记录的基准状态，根据指法计算各时间点的手部状态值
3. 在 Blender 中根据手部状态值生成对应的动画
